local M = {}

local DIR = vim.env.HOME .. "/.local/share/nvim/sheets"
local TMP_FILE = DIR .. "/tmp.sheet"

local function open()
    vim.fn.system("mkdir -p " .. DIR .. " && touch " .. TMP_FILE)
    vim.cmd.edit(vim.env.HOME .. "/.local/share/nvim/sheets/tmp.sheet")
end

local function close()
    local buffs = vim.api.nvim_list_bufs()
    for i, value in ipairs(buffs) do
        local file = vim.api.nvim_buf_get_name(value)
        if file == TMP_FILE then
            vim.cmd.write(i)
            vim.cmd.bdelete(i)
        end
    end
    -- vim.fn.system("rm " .. vim.env.HOME .. "/.local/share/nvim/sheets/tmp.sheet")
end


local function thing(opts)
    local cmd = opts.fargs[1]
    if (cmd == 'open') then
        open()
    elseif (cmd == 'close') then
        close()
    end
end

M.setup = function()
    vim.api.nvim_create_user_command("Sheet", thing, { nargs = 1 })
end

M.setup()

print("sourced file!")

